"use strict";angular.module("jwtApp",["ui.router","ngAnimate"]),angular.module("jwtApp").config(["$urlRouterProvider","$stateProvider","$httpProvider",function(a,b,c){a.otherwise("/"),b.state("main",{url:"/",templateUrl:"/views/main.html"}).state("register",{url:"/register",templateUrl:"/views/register.html",controller:"RegisterCtrl"}).state("logout",{url:"/logout",controller:"LogoutCtrl"}).state("links",{url:"/links",templateUrl:"/views/links.html",controller:"LinksCtrl"}).state("login",{url:"/login",templateUrl:"/views/login.html",controller:"LoginCtrl"}),c.interceptors.push("authInterceptor")}]).constant("API_URL","https://jwt-backend.herokuapp.com/").constant("EMAIL_REGEX",/^(([^<>()[\]\\.,;:\s@']+(\.[^<>()[\]\\.,;:\s@']+)*)|('.+'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).constant("URL_REGEX",/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/),angular.module("jwtApp").directive("validateEquals",function(){return{require:"ngModel",link:function(a,b,c,d){function e(b){var e=b===a.$eval(c.validateEquals);return d.$setValidity("equal",e),e?b:void 0}d.$parsers.push(e),d.$formatters.push(e),a.$watch(c.validateEquals,function(){d.$setViewValue(d.$viewValue)})}}}),angular.module("jwtApp").controller("RegisterCtrl",["$scope","alert","auth","EMAIL_REGEX",function(a,b,c,d){a.emailRegex=d,a.style=function(){var b={width:"0%"};try{b.width=a.password.length>=8?"0":12.5*a.password.length+"%"}catch(c){}return b},a.submit=function(){c.register(a.email,a.password,a.password_confirm).success(function(a){b("success","Account Created!","Welcome, "+a.user.email+"!")}).error(function(a){b("warning","Oops!",a[0])})}}]),angular.module("jwtApp").service("alert",["$rootScope","$timeout",function(a,b){var c;return function(d,e,f,g){a.alert={hasBeenShown:!0,show:!0,type:d,message:f,title:e},b.cancel(c),c=b(function(){a.alert.show=!1},g||5e3)}}]),angular.module("jwtApp").factory("authToken",["$window",function(a){var b,c=a.localStorage,d="userToken",e={setToken:function(a){b=a,c.setItem(d,a)},getToken:function(){return b||(b=c.getItem(d)),b},removeToken:function(){b=null,c.removeItem(d)},isAuthenticated:function(){return!!e.getToken()}};return e}]),angular.module("jwtApp").controller("HeaderCtrl",["$scope","authToken",function(a,b){a.isAuthenticated=b.isAuthenticated}]),angular.module("jwtApp").controller("LogoutCtrl",["authToken","alert","$state",function(a,b,c){a.removeToken(),b("success","You Logged Out","JWT Cleared from Local Storage!"),c.go("main")}]),angular.module("jwtApp").controller("LinksCtrl",["$scope","$http","API_URL","alert",function(a,b,c,d){a.user=!1,b.get(c+"links").success(function(b){a.links=b.links,a.user=b.user}).error(function(a){d("warning","Unable to get links",a.message)})}]),angular.module("jwtApp").factory("authInterceptor",["authToken",function(a){return{request:function(b){var c=a.getToken();return c&&(b.headers.Authorization="Bearer "+c),b},response:function(a){return a}}}]),angular.module("jwtApp").controller("LoginCtrl",["$scope","alert","authToken","auth","EMAIL_REGEX",function(a,b,c,d,e){a.emailRegex=e,a.submit=function(){d.login(a.email,a.password).success(function(a){b("success","Welcome back, ",a.user.email+"!")}).error(function(a){b("warning","Oops!",a.message)})}}]),angular.module("jwtApp").service("auth",["$http","API_URL","authToken","$state",function(a,b,c,d){function e(a){c.setToken(a.token),d.go("main")}this.login=function(c,d){return a.post(b+"login",{user:{email:c,password:d}}).success(e)},this.register=function(c,d,f){return a.post(b+"register",{user:{email:c,password:d,password_confirmation:f}}).success(e)}}]),angular.module("jwtApp").controller("PostlinkCtrl",["$scope","$http","$timeout","alert","API_URL","URL_REGEX",function(a,b,c,d,e,f){function g(b){c(function(){a.$apply(function(){a.newLinks.unshift(b)})})}a.newLinks=[],a.urlRegex=f,a.submit=function(){var c={link:{name:a.name,url:a.url}};b.post(e+"links",c).success(function(){g(c),d("success","Success! ","Added link to "+c.link.name+"!")}).error(function(){})},a.deleteLink=function(c){console.log(c);var f=a.links.indexOf(c);b["delete"](e+"links/"+c.id).success(function(){a.links.splice(f,1),d("success","Success! ","Link deleted")}).error(function(a){d("warning","Oops! ",a.message)})}}]),angular.module("jwtApp").directive("d-link",function(){return{controller:["$scope",function(a){a.removeLink=function(){}}]}});